<% if @shop.nil? %>
お店のデータが存在しません
<% elsif @memo.nil? %>
このお店は行けません
<% else %>

<div id="map-test01"></div>

お店の名前：<%= @shop.shop_name %> <br>
お店の場所：<%= @shop.shop_address %> <br>
お気に入り度：<%= @memo.favorite %> <br>
<%= form_with url: "./update" do |form|%>
  <%= form.submit value: 'お気に入り変更' %><br>
  <%= form.hidden_field :favo, value: 'favo' %>
  <%= form.hidden_field :place_id, value: @memo.place_id %>
  <%= form.hidden_field :user_id, value: @memo.user_id %>
<% end %><br>

行った回数：<%= @memo.count %>
<%= form_with url: "./update" do |form|%>
  <%= form.submit value: '行った' %><br>
  <%= form.hidden_field :count, value: 'count' %>
  <%= form.hidden_field :place_id, value: @memo.place_id %>
  <%= form.hidden_field :user_id, value: @memo.user_id %>
<% end %><br>

<div id="view_memo" style="display:inline;">
<h2>メモ  <input type="button" onclick="toggle_memo_btn()" value="編集" style= "margin: 20px;"></h2>
<%= memo_empty(@memo.memo) %>
</div>


<div id="edit_memo" style="display:none;">
<h2>メモ編集  <input type="button" onclick="toggle_memo_btn()" value="編集中断" style= "margin: 20px;"></h2>

<%= form_with url: "./update" do |form|%>
  <%= form.submit value: '保存' %><br>
  <%= form.text_area :memo , size: "50x60", value: @memo.memo %>
  <%= form.hidden_field :place_id, value: @memo.place_id %>
  <%= form.hidden_field :user_id, value: @memo.user_id %>
<% end %>
<% end %>

<script src="http://maps.google.com/maps/api/js?key=<%= Constants::GOOGLE_API_KEY%>&language=ja"></script>
<script type="text/javascript">
function toggle_memo_btn( ){
  const edit_memo = document.getElementById( 'edit_memo' );
  const view_memo = document.getElementById( 'view_memo' );

  edit_memo.style.display = edit_memo.style.display == 'inline' ? 'none' :'inline';
  view_memo.style.display = view_memo.style.display == 'inline' ? 'none' :'inline';
}





 var BaseLatLng = new google.maps.LatLng(gon.base.lat, gon.base.lng); //座標を指定

 var Options = {
 zoom: 16, //地図の縮尺値を指定
 center: BaseLatLng, //地図の中心座標
 mapTypeId: 'roadmap', //地図の種類を指定,
 mapTypeControl: false,
scaleControl: false,
disableDoubleClickZoom:false,
zoomControl:false,
scrollwheel:false
 };


 var map = new google.maps.Map(document.getElementById('map-test01'), Options); //埋め込むMAPのidを指定
 //マーカーの指定
var marker = new google.maps.Marker({
    position: BaseLatLng,
    map: map, 
    icon: 
      '	https://maps.google.com/mapfiles/ms/micons/green-dot.png',
});

let PlaceMarkers = [];
let infoWindow = [];
for(let i=0;i<gon.place_num;i++){

  let tmp = new google.maps.LatLng(gon.place_lat[i], gon.place_lng[i]);
  console.log(gon.place_lat[i]);
  PlaceMarkers[i] = new google.maps.Marker({
                    position: tmp,
                    map: map, 
                    icon: new google.maps.MarkerImage(
                             'http://www.google.com/mapfiles/marker' +gon.A_Z_Char[i] + '.png',//マーカー画像URL
                              new google.maps.Size(20, 34),//マーカーの表示サイズ（画像サイズに合わせる）
                              new google.maps.Point(0, 0),//マーカー画像表示の起点（変更しない）
                              new google.maps.Point(20, 34)//マーカー位置の調整（適時）
                              ), });
  // 吹き出しの追加
  infoWindow[i] = new google.maps.InfoWindow({
    //content: '<a href="https://www.google.co.jp/maps/dir/' + gon.base.lat + ',' + gon.base.lng + '/' + gon.place_lat[i] + ',' + gon.place_lng[i] + '">' + gon.place_name[i] + '</a>'
    content: '<a href="https://www.google.com/maps/dir/?api=1&origin=' + gon.base.lat + ',' + gon.base.lng + '&destination=' + gon.place_name[i] +'&destination_place_id=' + gon.place_id[i]+ '&travelmode=walking' + '">' + gon.place_name[i] + '</a>'
    });
            
  markerEvent(i); 
}
// マーカークリック時に吹き出しを表示する
function markerEvent(i) {
  PlaceMarkers[i].addListener('click', function() {
    infoWindow[i].open(map, PlaceMarkers[i]);
  });
}           




</scrip>

